<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëª¨ì˜íˆ¬ì AI ì£¼ì‹ ë¶„ì„ ë° ì£¼ë¬¸ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="/staticEsc/popup.js?v=1.0.2"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; padding: 40px; text-align: center; background: #f1f5f9; color: #1e293b; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        h1 { font-size: 24px; margin-bottom: 10px; }
        p { color: #64748b; margin-bottom: 30px; }
        
        .btn-report { width: 100%; padding: 15px; font-size: 16px; font-weight: bold; cursor: pointer; background: #1e293b; color: white; border: none; border-radius: 8px; margin-bottom: 25px; transition: background 0.2s; }
        .btn-report:hover { background: #334155; }

        .ai-section { border-top: 2px dashed #e2e8f0; padding-top: 25px; text-align: left; }
        .ai-title { font-size: 14px; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .input-group { display: flex; gap: 8px; }
        input { flex: 1; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; outline: none; }
        .btn-send { padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        #aiResponseResult { margin-top: 15px; padding: 12px; border-radius: 6px; font-size: 13px; min-height: 40px; display: none; background: #f8fafc; border: 1px solid #e2e8f0; line-height: 1.5; }
        
        /* ëª¨ë‹¬ì´ ë“¤ì–´ê°ˆ ì»¨í…Œì´ë„ˆ */
        #modalContainer { position: relative; z-index: 9999; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ“Š ëª¨ì˜íˆ¬ì AI ì£¼ì‹ ê´€ë¦¬ í…ŒìŠ¤íŠ¸</h1>
        <p>ë¶„ì„ ë¦¬í¬íŠ¸ í™•ì¸ ë° AI ì£¼ë¬¸ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        
        <button class="btn-report" onclick="openAnalysisReport('user_0008')">
            ğŸ“ˆ 'user_0008' ìì‚° ë¶„ì„ ë¦¬í¬íŠ¸ ì—´ê¸°
        </button>

        <div class="ai-section">
            <div class="ai-title">ğŸ¤– ëª¨ì˜íˆ¬ì AI ì£¼ì‹ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸</div>
            <div class="input-group">
                <input type="text" id="aiCommandInput" placeholder="'ì‚¼ì„±ì „ì 5ì£¼ ë§¤ìˆ˜í•´ì¤˜'">
                <button class="btn-send" onclick="testAiCommand()">ì „ì†¡</button>
            </div>
            <div id="aiResponseResult"></div>
        </div>
    </div>

    <div id="modalContainer"></div>

    <script>
        /**
         * íŒì—…ì„ ìƒˆ ì°½ìœ¼ë¡œ ë„ìš°ëŠ” ëŒ€ì‹ , 
         * ìš°ë¦¬ê°€ ë§Œë“  popup.jsì˜ getStockModalDOMì„ ì‹¤í–‰í•˜ì—¬ í˜„ì¬ ì°½ì— ëª¨ë‹¬ì„ ë„ì›ë‹ˆë‹¤.
         */
        function openAnalysisReport(userId) {
            // popup.jsì— ì •ì˜ëœ í•¨ìˆ˜ í˜¸ì¶œ
            if (typeof getStockModalDOM === 'function') {
                getStockModalDOM(userId);
            } else {
                console.error("popup.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        async function testAiCommand() {
            const input = document.getElementById('aiCommandInput');
            const resultDiv = document.getElementById('aiResponseResult');
            const command = input.value.trim();
            if (!command) return;

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = "â³ AI ë¶„ì„ ì¤‘...";

            try {
                const formData = new FormData();
                formData.append('in_message', command);
                formData.append('in_user_id', 'user_0008'); 
                formData.append('in_invest_amount', '10000000');

                const response = await fetch('/esc/chatEsc', { method: 'POST', body: formData });
                const data = await response.json();

                if (response.ok) {
                    resultDiv.style.color = '#059669';
                    resultDiv.innerHTML = `âœ… <b>AI ì‘ë‹µ:</b><br>${data.response}`;
                }
            } catch (error) {
                resultDiv.style.color = '#dc2626';
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜ ë°œìƒ`;
            }
        }
    </script>
</body>
</html>