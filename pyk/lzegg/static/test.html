<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëª¨ì˜íˆ¬ì AI ì£¼ì‹ ë¶„ì„ ë° ì£¼ë¬¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; padding: 40px; text-align: center; background: #f1f5f9; color: #1e293b; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        h1 { font-size: 24px; margin-bottom: 10px; }
        p { color: #64748b; margin-bottom: 30px; }
        
        /* ë¶„ì„ ë¦¬í¬íŠ¸ ë²„íŠ¼ */
        .btn-report { width: 100%; padding: 15px; font-size: 16px; font-weight: bold; cursor: pointer; background: #1e293b; color: white; border: none; border-radius: 8px; margin-bottom: 25px; transition: background 0.2s; }
        .btn-report:hover { background: #334155; }

        /* AI ëª…ë ¹ì–´ ì„¹ì…˜ */
        .ai-section { 
            border-top: 2px dashed #e2e8f0; 
            padding-top: 25px; /* pt ëŒ€ì‹  padding-top */
            text-align: left; 
        }
        .ai-title { font-size: 14px; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .input-group { display: flex; gap: 8px; }
        input { flex: 1; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; outline: none; }
        input:focus { 
            border-color: #3b82f6; 
            outline: none; 
            box-shadow: 0 0 0 2px #bfdbfe; /* ring íš¨ê³¼ ëŒ€ì‹  box-shadow ì‚¬ìš© */
        }
        .btn-send { padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-send:hover { background: #2563eb; }

        /* ê²°ê³¼ í‘œì‹œ ì°½ */
        #aiResponseResult { margin-top: 15px; padding: 12px; border-radius: 6px; font-size: 13px; min-height: 40px; display: none; background: #f8fafc; border: 1px solid #e2e8f0; line-height: 1.5; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ“Š ëª¨ì˜íˆ¬ì AI ì£¼ì‹ ê´€ë¦¬ í…ŒìŠ¤íŠ¸ ë³´ë“œ</h1>
        <p>ëª¨ì˜íˆ¬ì ë¶„ì„ ë¦¬í¬íŠ¸ í™•ì¸ ë° ëª¨ì˜íˆ¬ì AI ì£¼ë¬¸ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        
        <button class="btn-report" onclick="getEscAnalysisTest('user1')">
            ğŸ“ˆ ëª¨ì˜íˆ¬ì ì„±ê³µ ì‚¬ë¡€ ìì‚° ë¶„ì„ ë¦¬í¬íŠ¸ íŒì—… ì—´ê¸°
        </button>

        <div class="ai-section">
            <div class="ai-title">ğŸ¤– ëª¨ì˜íˆ¬ì AI ì£¼ì‹ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸</div>
            <div class="input-group">
                <input type="text" id="aiCommandInput" placeholder="'ì‚¼ì„±ì „ì 5ì£¼ ë§¤ìˆ˜í•´ì¤˜' ë¼ê³  ì…ë ¥í•´ë³´ì„¸ìš”" 
                       onkeypress="if(event.keyCode==13) testAiCommand()">
                <button class="btn-send" onclick="testAiCommand()">ì „ì†¡</button>
            </div>
            <div id="aiResponseResult"></div>
        </div>
    </div>

    <script>
        /**
         * [ê¸°ëŠ¥ 1] ë¶„ì„ ë¦¬í¬íŠ¸ íŒì—…ì°½ ì‹¤í–‰
         * @description ì‚¬ìš©ìë³„ íˆ¬ì ë¶„ì„ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ëŠ” ìƒˆ ë¸Œë¼ìš°ì € íŒì—…ì°½ì„ ì¤‘ì•™ì— ë°°ì¹˜í•˜ì—¬ ì‹¤í–‰
         * @param {string} in_userId - ë¦¬í¬íŠ¸ë¥¼ ì¡°íšŒí•  ì‚¬ìš©ì ì‹ë³„ ID
         */
        function getEscAnalysisTest(in_userId) {
            // 1. í™”ë©´ì˜ ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ë„ˆë¹„ì™€ ë†’ì´ ê³„ì‚°
            const width = Math.min(screen.availWidth, 1200); // ìµœëŒ€ 1200pxë¡œ ì œí•œí•˜ê±°ë‚˜
            const height = Math.min(screen.availHeight, 800);
            
            // 2. í™”ë©´ ì¤‘ì•™ ë°°ì¹˜ë¥¼ ìœ„í•œ ì¢Œí‘œ ê³„ì‚°
            const left = (screen.availWidth - width) / 2;
            const top = (screen.availHeight - height) / 2;

            const popupUrl = `${window.location.origin}/show-popupEsc?in_userId=${in_userId}`;
            
            // 3. íŒì—… ì˜µì…˜ ë¬¸ìì—´
            const specs = `width=${width},height=${height},left=${left},top=${top},` +
                        `menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes`;

            window.open(popupUrl, "AnalysisReport", specs);
        }

        /**
         * [ê¸°ëŠ¥ 2] AI ëª…ë ¹ì–´ ì „ì†¡ ë° ì‘ë‹µ ì²˜ë¦¬ (ë¹„ë™ê¸°)
         * @description ì‚¬ìš©ìì˜ ì…ë ¥ ëª…ë ¹ì–´ë¥¼ ì„œë²„(FastAPI)ì— FormData í˜•íƒœë¡œ ì „ì†¡í•˜ê³  ë¶„ì„ ê²°ê³¼ë¥¼ í™”ë©´ì— ë Œë”ë§
         */
        async function testAiCommand() {
            const input = document.getElementById('aiCommandInput');
            const resultDiv = document.getElementById('aiResponseResult');
            const command = input.value.trim();

            if (!command) {
                alert("ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = "â³ AIê°€ ëª…ë ¹ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

            try {
                // FormData ê°ì²´ ìƒì„± (FastAPIì˜ Form(...)ì„ ë°›ê¸° ìœ„í•¨)
                const formData = new FormData();
                formData.append('in_message', command);
                formData.append('in_user_id', 'user1'); // í…ŒìŠ¤íŠ¸ìš© ID
                formData.append('in_invest_amount', '10000000');

                const response = await fetch('/esc/chatEsc', { // ê²½ë¡œ ìˆ˜ì •: /api/ai-order -> /esc/chatEsc
                    method: 'POST',
                    body: formData // JSON ëŒ€ì‹  formData ì „ì†¡
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.style.color = '#059669';
                    // ì„œë²„ ì‘ë‹µì´ {"response": "..."} í˜•íƒœì´ë¯€ë¡œ data.response ì¶œë ¥
                    resultDiv.innerHTML = `âœ… <b>AI ì‘ë‹µ:</b><br>${data.response}`;
                } else {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
            } catch (error) {
                resultDiv.style.color = '#dc2626';
                resultDiv.innerHTML = `âŒ <b>ì˜¤ë¥˜ ë°œìƒ:</b><br>ì„œë²„ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”. (ê²½ë¡œ: /esc/chatEsc)`;
            }
        }
    </script>
</body>
</html>