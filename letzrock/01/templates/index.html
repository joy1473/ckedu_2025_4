<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>오픈뱅킹 사용자 등록</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  </head>
  <body>
    <form id="myForm" method="post" class="block w-1/2 min-x-36 mx-auto mt-5">
      <button type="button" id="btnAuth" class="block mx-auto my-3 px-4 py-2 rounded-md bg-blue-700 text-white">오픈뱅킹 사용자 인증</button>
      <div id="errorMessage" class="p-3"></div>
    </form>
    <script>
      $(function(){
        const onMessage = function (e) {
          if (console) {
            console.log(e.data);
          }
          if (e.data && e.data.success) {
            window.removeEventListener('message', onMessage, false);
            $('#btnAuth').removeAttr('disabled').hide();
            $('#userContainer').show();
          } else if (e.data.message) {
            $('#errorMessage').html(e.data.message);
          }
        };

        $('#btnAuth').on('click', function() {
          const containerWidth = screen ? screen.availWidth : window.innerWidth;
          const containerHeight = screen ? screen.availHeight : window.innerHeight;
          const w = 520;
          const h = containerHeight > 800 ? 800 : containerHeight;
          const features = `toolbar=no,width=${w},height=${h},left=${Math.round((containerWidth - w) / 2)},top=${Math.round((containerHeight - h) / 2)}`;
          window.open('/auth/', 'OPENBANK_AUTH', features);
          $(this).prop('disabled', true);
          $('#errorMessage').empty();
          //window.addEventListener('message', onMessage, false);
          window.setTimeout(() => {
            $('#btnAuth').removeAttr('disabled');
          }, 2000);
          return false;
        });
      })
    </script>
  </body>
</html>